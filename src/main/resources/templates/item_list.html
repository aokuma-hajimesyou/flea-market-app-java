<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>商品一覧 - フリマアプリ</title>
	<link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
	<div class="container">
		<h1>商品一覧</h1>

		<div class="main-nav">
			<a th:href="@{/items/new}" class="button">商品を出品する</a>
			<a th:href="@{/my-page}" class="button">マイページ</a>
			<form th:action="@{/logout}" method="post" style="display:inline;">
				<button type="submit" class="button secondary">ログアウト</button>
			</form>
		</div>

		<form th:action="@{/items}" method="get" class="filter-form">
			<div>
				<label for="keyword">キーワード:</label>
				<input type="text" id="keyword" name="keyword" th:value="${param.keyword}">
			</div>
			<div>
				<label for="categoryId">カテゴリ:</label>
				<select id="categoryId" name="categoryId">
					<option value="">全て</option>
					<option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}"
						th:selected="${param.categoryId == category.id}"></option>
				</select>
			</div>
			<button type="submit" class="button">検索</button>
		</form>

		<div class="item-grid">
			<div class="item-card" th:each="item : ${items.content}">
				<a th:href="@{/items/{id}(id=${item.id})}">
					<img th:src="${item.imageUrl != null ? item.imageUrl : '/images/placeholder.png'}" alt="商品画像">
					<h3 th:text="${item.name}"></h3>
					<p class="price" th:text="'¥' + ${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')}"></p>
					<p class="status" th:text="${item.status}"></p>
				</a>
			</div>
			<div th:if="${#lists.isEmpty(items.content)}">
				<p>商品が見つかりませんでした。</p>
			</div>
		</div>

		<div class="pagination" th:if="${items.totalPages > 0}">
			<a th:if="${items.hasPrevious()}"
				th:href="@{/items(page=${items.number - 1}, keyword=${param.keyword}, categoryId=${param.categoryId})}">前へ</a>

			<span th:each="i : ${#numbers.sequence(0, items.totalPages - 1)}">
				<a th:if="${i != items.number}"
					th:href="@{/items(page=${i}, keyword=${param.keyword}, categoryId=${param.categoryId})}"
					th:text="${i + 1}"></a>
				<span th:if="${i == items.number}" class="current-page" th:text="${i + 1}"></span>
			</span>

			<a th:if="${items.hasNext()}"
				th:href="@{/items(page=${items.number + 1}, keyword=${param.keyword}, categoryId=${param.categoryId})}">次へ</a>
		</div>
	</div>
</body>

</html>