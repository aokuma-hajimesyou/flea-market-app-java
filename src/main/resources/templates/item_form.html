<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${item.id == null ? '商品出品 - FleaMarketApp' : '商品編集 - FleaMarketApp'}"></title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
	<script th:src="@{/js/style.js}" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header class="app-header">
        <div class="header-inner">
            <h1 class="app-title"><a th:href="@{/items}">FleaMarketApp</a></h1>
        </div>
    </header>

    <div class="container">
        <div class="page-header" style="text-align: center;">
            <h1 th:text="${item.id == null ? '商品の出品' : '商品の編集'}"></h1>
            <p th:text="${item.id == null ? '売りたい商品の情報を入力してください。' : '商品の情報を修正して保存してください。'}"></p>
        </div>

        <div class="form-box">
            <div th:if="${errorMessage}" class="error-message:empty error-message" th:text="${errorMessage}"></div>

            <form th:action="${item.id == null ? '/items' : '/items/' + item.id}" method="post" enctype="multipart/form-data" id="item-form">
                <input type="hidden" th:if="${item.id != null}" name="_method" value="put">

                <div class="form-group">
                    <label for="name"><i class="fas fa-tag"></i> 商品名</label>
                    <input type="text" id="name" name="name" th:value="${item.name}" class="input-field" 
                           placeholder="例: 【美品】ワイヤレスイヤホン" required>
                </div>

				<div class="form-group">
				    <label for="parentCategory"><i class="fas fa-list"></i> カテゴリー</label>
				    <input type="hidden" id="finalCategoryId" name="categoryId" th:value="${item.category != null ? item.category.id : ''}" required>

				    <div class="category-row category-selects">
				        <select id="parentCategory" class="input-field" required>
				            <option value="">カテゴリーを選択</option>
				            <option th:each="category : ${categories}" 
				                    th:value="${category.id}" 
				                    th:text="${category.name}"></option>
				        </select>

				        <span class="category-arrow" id="childArrow" style="display:none;"><i class="fas fa-chevron-right"></i></span>
				        <select id="childCategory" class="input-field" style="display:none;"></select>

				        <span class="category-arrow" id="grandChildArrow" style="display:none;"><i class="fas fa-chevron-right"></i></span>
				        <select id="grandChildCategory" class="input-field" style="display:none;"></select>
				    </div>
				</div>

                <div class="form-group">
                    <label for="price"><i class="fas fa-yen-sign"></i> 販売価格</label>
                    <input type="number" id="price" name="price" th:value="${item.price}" class="input-field" 
                           placeholder="商品の値段を入力してください" required>
                </div>

                <div class="form-group">
                    <label for="description"><i class="fas fa-align-left"></i> 商品の説明</label>
                    <textarea id="description" name="description" th:text="${item.description}" class="input-field" 
                              rows="6" placeholder="商品の状態（傷、汚れ）、色、素材、サイズ、購入時期などを詳しく書くと売れやすくなります。"></textarea>
                </div>

				<div class="form-group">
				    <label for="image"><i class="fas fa-camera"></i> 商品画像</label>
				    <div style="border: 2px dashed #ddd; padding: 20px; border-radius: 8px; text-align: center; background: #fafafa;">
				        <input type="file" id="imageInput" name="image" accept="image/*" style="cursor: pointer;">
				        <p style="font-size: 0.8rem; color: #888; margin-top: 10px;">※10MB以下の画像を選択してください</p>
				    </div>
				    
				    <div id="new-preview-container" class="image-preview-container" style="display: none;">
				        <span class="current-img-label">選択中の画像:</span>
				        <img id="imagePreview" src="" class="preview-img">
				    </div>

				    <div th:if="${item.imageUrl}" id="existing-preview" class="image-preview-container">
				        <span class="current-img-label">現在の画像:</span>
				        <img th:src="${item.imageUrl}" class="preview-img">
				    </div>
				</div>

                <div class="button-group" style="margin-top: 30px;">
                    <button type="submit" id="submit-button" class="button" style="flex: 2;">
                        <i class="fas fa-check"></i> [[${item.id == null ? '出品する' : '変更を保存する'}]]
                    </button>
                    <a th:href="@{/items}" onclick="if(document.referrer.includes('/items')) { history.back(); return false; }" class="button secondary" style="flex: 1; text-align: center;">キャンセル</a>
                </div>
            </form>
        </div>
    </div>

    <div style="height: 60px;"></div>
	
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('item-form');
    const submitButton = document.getElementById('submit-button');

    if (form && submitButton) {
        form.addEventListener('submit', function() {
            // フォームが送信されたらボタンを無効化
            submitButton.disabled = true;
            // ローディング中のテキストなどが必要であればここに追加
            // submitButton.textContent = '処理中...';
        });
    }
});
</script>

</body>
</html>